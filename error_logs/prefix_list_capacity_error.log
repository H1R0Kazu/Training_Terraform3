# Terraform Apply Error Log - Prefix List Capacity Limit
# Date: 2025-11-21
# Command: terraform apply -auto-approve
# Error: Unable to increase Prefix List MaxEntries due to Security Group capacity

╷
│ Error: updating EC2 Managed Prefix List (pl-026264adbef1f2da0) increased MaxEntries : waiting for EC2 Managed Prefix List (pl-026264adbef1f2da0) MaxEntries update: unexpected state 'modify-failed', wanted target 'modify-complete'. last error: Unable to modify maximum entries from (10) to (50). The following VPC Security Group resources do not have sufficient capacity [sg-0b04a69009c80dd71].
│
│
│   with aws_ec2_managed_prefix_list.test_miyata,
│   on main.tf line 2, in resource "aws_ec2_managed_prefix_list" "test_miyata":
│    2: resource "aws_ec2_managed_prefix_list" "test_miyata" {
│
╵

## Error Analysis

**Resource:** aws_ec2_managed_prefix_list.test_miyata
**Resource ID:** pl-026264adbef1f2da0
**Location:** main.tf line 2

**Error Type:** Capacity constraint violation

**What happened:**
Attempted to increase Prefix List max_entries from 10 to 50, but the operation failed because the associated Security Group (sg-0b04a69009c80dd71) does not have sufficient capacity to accommodate the change.

**Root Cause:**
AWS calculates Security Group capacity as:
  Security Group Capacity = Number of Rules × Prefix List MaxEntries

Current configuration:
  - Security Group Rules: 3 (HTTPS/443, HTTP/80, SSH/22)
  - Current MaxEntries: 10
  - Current Capacity: 3 × 10 = 30 ✅

Attempted configuration:
  - Security Group Rules: 3 (same)
  - New MaxEntries: 50
  - Required Capacity: 3 × 50 = 150 ❌

AWS Limit: 60 rules/capacity per security group

**Conclusion:**
The attempted configuration (150 capacity) exceeds AWS's 60 rule limit for security groups.

## Affected Resources

- Prefix List: pl-026264adbef1f2da0 (test-miyata-prefix-list)
- Security Group: sg-0b04a69009c80dd71 (test-sg-with-prefix-list)
- VPC: vpc-026cf542cccbb039e (udemy)

## Resolution

To increase MaxEntries to 50, one of the following changes is required:

1. Reduce the number of rules referencing the Prefix List to 1 (1 × 50 = 50 ≤ 60)
2. Keep the current MaxEntries at 10 or lower
3. Use a different architecture that doesn't rely on Prefix Lists for multiple rules

Current decision: Maintain MaxEntries=10 with 3 rules (30 capacity) for balanced configuration.
